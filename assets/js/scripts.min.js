jQuery(function(e) {
    var a = !0,
        s = !1,
        r = !1,
        n = e('.seedpay_payment_cart_hash').val()

    function p(s) {
        var o = e('#seedpayPhoneNumber').val()
        n || !s ? jQuery.post(seedpay_params.ajax_url, {
            action: 'checkTransactionStatus',
            transaction_id: n,
            phone: o,
        }, function(n) {
            var o = e.parseJSON(n)
            if (o.error || o.response && !o.response[0]) return e('.seedpay-messages').html(o.error), e('.seedpay-number-form-pending').hide(), e('.seedpay-number-form').fadeIn(), a = !1, s && s({
                error: o.error,
            }), o.error
            var t = (o.response[0] || {}).status
            "acceptedAndPaid" == t ? (e('.seedpay_payment_success').val(o.response[0].status), e('.seedpay-number-form').hide(), e('.seedpay-number-form-pending').hide(), e('.seedpay-number-form-success').fadeIn(), e('.woocommerce-checkout').submit(), a = !1) : 'rejected' == t || 'errored' == t ? (e('.seedpay-number-form-pending').hide(), e('.seedpay-number-form').fadeIn(), a = !1) : r || (r = !0, function e() {
                a ? setTimeout(function() {
                    p(), e()
                }, 5e3) : r = !1
            }()), s && s()
        }) : s()
    }

    function o() {
        p(function() {
            e('.seedpay-number-form-pending').hide(), e('.seedpay-number-form').fadeIn(), e('.seedpay-messages').empty('')
            var a = e('#seedpayPhoneNumber').val()
            jQuery.post(seedpay_params.ajax_url, {
                action: 'requestPayment',
                phone: a,
            }, function(a) {
                var s = e.parseJSON(a)
                s.response.message && (e('.seedpay-messages').html(s.response.message), s.response.message.toLowerCase().indexOf('inv') >= 0) ? t() : s.error ? e('.seedpay-messages').html(s.error) : (n = s.request.uniqueTransactionId, e('.seedpay_payment_cart_hash').val(n), e('.seedpay-messages').html(s.response.message), e('.seedpay-number-form').fadeOut(), e('.seedpay-number-form-pending').fadeIn(), p())
            })
        })
    }

    function t() {
        var r = e('#seedpayPhoneNumber').val()
        jQuery.post(seedpay_params.ajax_url, {
            action: 'checkUserStatus',
            phone: r,
        }, function(r) {
            if (1 == e.parseJSON(r).response.isRegistered) return e('.seedpay_payment_registered').val(1), void o()
            e('.seedpay_payment_registered').val(0), e('.seedpay-messages').html('Please check your text messages for an invite.'), a = !0, s || (s = !0, function e() {
                a ? setTimeout(function() {
                    t(), e()
                }, 5e3) : s = !1
            }())
        })
    }
    1 == e('.seedpay_recheck_payment').val() && p(), e('form.woocommerce-checkout').on('checkout_place_order', function() {
        if (e('#payment_method_seedpay').is(':checked')) return '' != e('#seedpayPhoneNumber').val() && (a = !0, o()), !0
    }), e(document).on('click', '.seedpay-cancel-payment-submit', function() {
        return e('.seedpay-number-form-pending').hide(), e('.seedpay-number-form').fadeIn(), e('.seedpay-messages').empty(''), a = !1, !1
    })
})

jQuery(function(e){var a=!1,s=!1,r=e(".seedpay_payment_cart_hash").val();function n(a){var p=e("#seedpay_payment_phone").val();r||!a?jQuery.post(seedpay_params.ajax_url,{action:"ajax_seedpay_check_request",transaction_id:r,phone:p},function(r){var p=e.parseJSON(r);if(p.error||p.response&&!p.response[0])return e(".seedpay-messages").html(p.error),e(".seedpay-number-form-pending").hide(),e(".seedpay-number-form").fadeIn(),s=!1,a&&a({error:p.error}),p.error;var o=(p.response[0]||{}).status;"acceptedAndPaid"==o?(e(".seedpay_payment_success").val(p.response[0].status),e(".seedpay-number-form").hide(),e(".seedpay-number-form-pending").hide(),e(".seedpay-number-form-success").fadeIn(),e(".woocommerce-checkout").submit(),s=!1):"rejected"==o||"errored"==o?(e(".seedpay-number-form-pending").hide(),e(".seedpay-number-form").fadeIn(),s=!1):(s=!0,setTimeout(function(){s&&n()},5e3)),a&&a()}):a()}function p(){n(function(){e(".seedpay-number-form-pending").hide(),e(".seedpay-number-form").fadeIn(),e(".seedpay-messages").empty("");var o=e("#seedpay_payment_phone").val();jQuery.post(seedpay_params.ajax_url,{action:"ajax_seedpay_submit_request",phone:o},function(o){var t=e.parseJSON(o);t.response.message&&(e(".seedpay-messages").html(t.response.message),t.response.message.toLowerCase().indexOf("inv")>=0)?a||function s(){var r=e("#seedpay_payment_phone").val();jQuery.post(seedpay_params.ajax_url,{action:"ajax_checkUserStatus",phone:r},function(r){var n=e.parseJSON(r).response;1==n.isRegistered?(a=!1,e(".seedpay_payment_registered").val(1),p()):(e(".seedpay_payment_registered").val(0),e(".seedpay-messages").html("Please check your text messages for an invite."),a=!0,setTimeout(function(){a&&s(!0)},6e3))})}():t.error?e(".seedpay-messages").html(t.error):(r=t.request.uniqueTransactionId,e(".seedpay_payment_cart_hash").val(r),e(".seedpay-messages").html(t.response.message),e(".seedpay-number-form").fadeOut(),e(".seedpay-number-form-pending").fadeIn(),s||n())})})}1==e(".seedpay_recheck_payment").val()&&(s||n()),e("form.woocommerce-checkout").on("checkout_place_order",function(){if(e("#payment_method_seedpay").is(":checked"))return""!=e("#seedpay_payment_phone").val()&&p(),!0}),e(document).on("click",".seedpay-cancel-payment-submit",function(){return e(".seedpay-number-form-pending").hide(),e(".seedpay-number-form").fadeIn(),e(".seedpay-messages").empty(""),s=!1,a=!1,!1})});